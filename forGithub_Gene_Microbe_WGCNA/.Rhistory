############# neural Subset heatmap ##################
neural_df <- df.sets.ann %>%
filter(
str_detect(annote, "acetylcholine") |
str_detect(annote, "synaptotagmin") |
str_detect(annote, "synaptic") |
str_detect(annote, "G-protein") |
str_detect(annote, "Acetylcholinesterase") |
str_detect(annote, "Dopamine") |
str_detect(annote, "GABA") |
str_detect(annote, "histamine") |
str_detect(annote, "neuroendocrine") |
str_detect(annote, "voltage-dependent") |
str_detect(annote, "voltage-gated") |
str_detect(annote, "calcium channel") |
str_detect(annote, "NMDA") |
str_detect(annote, "glutamate receptor") |
str_detect(annote, "neuro") |
str_detect(annote, "neurotrypsin") |
str_detect(annote, "synapse") |
str_detect(annote, "SNARE") |
str_detect(annote, "neuronal ")
)
neural_df_select <- df.sets.ann %>%
filter(
str_detect(annote, "synaptotagmin") |
str_detect(annote, "synaptic") |
str_detect(annote, "G-protein") |
str_detect(annote, "GABA") |
str_detect(annote, "FRMF") |
str_detect(annote, "histamine") |
str_detect(annote, "calcium channel") |
str_detect(annote, "NMDA") |
str_detect(annote, "glutamate receptor") |
str_detect(annote, "neurotrypsin") |
str_detect(annote, "SNARE")
)
############# Stress and Detox Subset heatmap ##################
stress_df <- df.sets.ann %>%
filter(
str_detect(annote, "superoxide") | # Oxidative Stress and Antioxidant Defense
str_detect(annote, "thioredoxin") |
str_detect(annote, "NADH") |
str_detect(annote, "NADPH oxidase") |
str_detect(annote, "xanthine") |
str_detect(annote, "peroxiredoxin") |
str_detect(annote, "Glutathione S-transferase") |
str_detect(annote, "Glutaredoxin") |
str_detect(annote, "Heat shock") | # Heat shock and chaperones
str_detect(annote, "hsp") |
str_detect(annote, "Proteasome") |
str_detect(annote, "p450") | # Detoxification and Xenobiotic Metabolism
str_detect(annote, "glucuronosyltransferase") |
str_detect(annote, "sulfotransferase") |
str_detect(annote, "carboxylesterase") |
str_detect(annote, "ATP-binding cassette") |
str_detect(annote, "repair") | # DNA Repair and Damage
str_detect(annote, "E3 ubiquitin")
)
stress_df_select <- df.sets.ann %>%
filter(
str_detect(annote, "superoxide") | # Oxidative Stress and Antioxidant Defense
str_detect(annote, "thioredoxin") |
str_detect(annote, "NADPH oxidase") |
str_detect(annote, "xanthine") |
str_detect(annote, "peroxiredoxin") |
str_detect(annote, "Glutathione S-transferase") |
str_detect(annote, "Glutaredoxin") |
str_detect(annote, "Heat shock") | # Heat shock and chaperones
str_detect(annote, "hsp") |
str_detect(annote, "Proteasome") |
str_detect(annote, "p450") | # Detoxification and Xenobiotic Metabolism
str_detect(annote, "glucuronosyltransferase") |
str_detect(annote, "sulfotransferase") |
str_detect(annote, "carboxylesterase") |
str_detect(annote, "repair") # DNA Repair and Damage
)
########### Plot ##############
library(gridExtra)
heat.plot <- function(df,title,lfc_cut=0.0) {
degs_cut <- degs[abs(degs$log2FoldChange) >= lfc_cut,]
df <- df[df$Gene %in% degs_cut$gene_id,]
##########.
df <- df %>%
group_by(Gene) %>%
#mutate(norm_expression = (expression - min(expression)) / (max(expression) - min(expression)))
mutate(norm_expression = 2 * ((expression - min(expression)) / (max(expression) - min(expression))) - 1)
# Pivot to wide format (genes as rows, samples as columns)
df_wide <- df %>%
dplyr::select(sample, Gene, norm_expression) %>%
spread(key = sample, value = norm_expression)
# Create a vector of custom labels for the rows (annote_clean)
row_labels <- df %>%
distinct(Gene, annote_clean) %>%
arrange(match(Gene, df_wide$Gene)) %>%
pull(annote_clean)
# Step 5: Ensure that the first five samples are Naive, and the next five are Exposed
# Create a vector for column annotation
sample_labels <- ifelse(colnames(df_wide)[-1] %in% df$sample[df$group == "Naive"], "Naive", "Exposed")
# Convert the expression data (wide format) to a matrix (excluding 'unique_label' column)
df_matrix <- as.matrix(df_wide[, -1])  # Exclude 'unique_label' column
col_anno <- data.frame(group = sample_labels)
rownames(col_anno) <- colnames(df_matrix)
annotation_colors <- list(group = c("Naive" = "skyblue", "Exposed" = "salmon"))
p <- pheatmap(df_matrix,
cellwidth = 15,
cellheight = 15,
border_color = NA,
cluster_rows = TRUE,
cluster_cols = FALSE,
scale = "none",
color = colorRampPalette(c("mediumseagreen","white","purple3"))(100),
show_rownames = TRUE,
show_colnames = FALSE,
labels_row = row_labels,
treeheight_row = 0,
treeheight_col = 0,
fontsize = 12,
fontfamily = "Arial"
)
#library(gridExtra)
#grid.arrange(i$gtable, t$gtable, ncol=2)
return(p)
}
#immune plots
comp <- heat.plot(complement_df,"complement cascade")
reg <- heat.plot(inflam_df,"immune regulation and cell death")
rec <- heat.plot(recog_df,"pathogen recognition and defense")
grid.arrange(comp$gtable, rec$gtable,reg$gtable, ncol=1)
#tissue plots
ecm <- heat.plot(ecm_df,"ECM")
adh <- heat.plot(adh.sig_df,"singal and adhesion")
rem <- heat.plot(rem.rep_df,"remodeling genes")
grid.arrange(comp$gtable, reg$gtable, rec$gtable, ncol=3)
#########.
df <- complement_df
#### pick to separate or combine like-genes
### optional filter for lfc > set paramiter #####
lfc_cut = 0.0
degs_cut <- degs[abs(degs$log2FoldChange) >= lfc_cut,]
df <- df[df$Gene %in% degs_cut$gene_id,]
##########.
df <- df %>%
group_by(Gene) %>%
mutate(norm_expression = (expression - min(expression)) / (max(expression) - min(expression)))
# Pivot to wide format (genes as rows, samples as columns)
df_wide <- df %>%
dplyr::select(sample, Gene, norm_expression) %>%
spread(key = sample, value = norm_expression)
# Create a vector of custom labels for the rows (annote_clean)
row_labels <- df %>%
distinct(Gene, annote_clean) %>%
arrange(match(Gene, df_wide$Gene)) %>%
pull(annote_clean)
# Step 5: Ensure that the first five samples are Naive, and the next five are Exposed
# Create a vector for column annotation
sample_labels <- ifelse(colnames(df_wide)[-1] %in% df$sample[df$group == "Naive"], "Naive", "Exposed")
# Convert the expression data (wide format) to a matrix (excluding 'unique_label' column)
df_matrix <- as.matrix(df_wide[, -1])  # Exclude 'unique_label' column
col_anno <- data.frame(group = sample_labels)
rownames(col_anno) <- colnames(df_matrix)
annotation_colors <- list(group = c("Naive" = "skyblue", "Exposed" = "salmon"))
pheatmap(df_matrix,
border_color = "grey20",
cluster_rows = TRUE,
cluster_cols = FALSE,
scale = "none",
color = colorRampPalette(c("springgreen3", "white", "purple"))(100),
show_rownames = TRUE,
show_colnames = FALSE,
main = "Immune Response",
labels_row = row_labels,
treeheight_row = 0,
treeheight_col = 0,
annotation_col = col_anno,
annotation_colors = annotation_colors,
fontsize=9
)
library(gridExtra)
grid.arrange(i$gtable, t$gtable, ncol=2)
# maing plots from GO MWU output of Salmon Module from WGNCA
#Top correlated genes in module
setwd("C:/Users/andre/Desktop/GitHub/AK_Pycno_RNAxMetagen/16s_Sylva/qiime2_fullset/WGCNA")
library(tidyverse)
library(data.table)
library(patchwork)
###differentually abundant genes
degs <- read.csv("C:/Users/andre/Desktop/GitHub/AK_Pycno_RNAxMetagen/Pycno_NE_STAR/annotations/NE_DEG_annotated.csv")
###differentially abundant microbes
microbes <- read.csv("C:/Users/andre/Desktop/GitHub/AK_Pycno_RNAxMetagen/16s_Sylva/ancombc_wgcna/8.1.24_res.NvE_Sylva.csv") # 244 microbial families found passing the >10 reads/sample average
dams <- microbes[microbes$diff_abn.site.animal.healthSH==TRUE,] # 39 differential abundance microbes
### Gene ontology mapping to DEGs
pGO <- fread("C:/Users/andre/Desktop/GitHub/AK_Pycno_RNAxMetagen/Pycno_NE_STAR/GO/Pycno_GO_formatted.tsv")
colnames(pGO) <- c("gene_id","GO")
degs_GO <- left_join(degs,pGO, by="gene_id")
dataExpr <- fread("C:/Users/andre/Desktop/GitHub/AK_Pycno_RNAxMetagen/16s_Sylva/qiime2_fullset/WGCNA/dataExpr_normfirst.txt")
dataExpr <- data.table(dataExpr)
# load in normalized DESeq2 counts data
rownames(dataExpr)
dataExpr$group <- case_when(
dataExpr$V1 %in% dataExpr$V1[1:5] ~ "Naive",
dataExpr$V1 %in% dataExpr$V1[6:10] ~ "Exposed"
)
### select all genes in red module that are also DEGs for plotting
red_deg_genes <- read.csv("C:/Users/andre/Desktop/GitHub/AK_Pycno_RNAxMetagen/16s_Sylva/qiime2_fullset/WGCNA/red_mod_degs_nf.csv")
redgenes <- read_lines("red_mod_genes_nf.txt")
dataExpr_reddeg <- dataExpr%>% select(c("V1", "group", redgenes))
# maing plots from GO MWU output of Salmon Module from WGNCA
#Top correlated genes in module
setwd("C:/Users/andre/Desktop/GitHub/AK_Pycno_RNAxMetagen/16s_Sylva/qiime2_fullset/WGCNA")
library(tidyverse)
library(data.table)
library(patchwork)
###differentually abundant genes
degs <- read.csv("C:/Users/andre/Desktop/GitHub/AK_Pycno_RNAxMetagen/Pycno_NE_STAR/annotations/NE_DEG_annotated.csv")
###differentially abundant microbes
microbes <- read.csv("C:/Users/andre/Desktop/GitHub/AK_Pycno_RNAxMetagen/16s_Sylva/ancombc_wgcna/8.1.24_res.NvE_Sylva.csv") # 244 microbial families found passing the >10 reads/sample average
dams <- microbes[microbes$diff_abn.site.animal.healthSH==TRUE,] # 39 differential abundance microbes
### Gene ontology mapping to DEGs
pGO <- fread("C:/Users/andre/Desktop/GitHub/AK_Pycno_RNAxMetagen/Pycno_NE_STAR/GO/Pycno_GO_formatted.tsv")
colnames(pGO) <- c("gene_id","GO")
degs_GO <- left_join(degs,pGO, by="gene_id")
dataExpr <- fread("C:/Users/andre/Desktop/GitHub/AK_Pycno_RNAxMetagen/16s_Sylva/qiime2_fullset/WGCNA/dataExpr_normfirst.txt")
dataExpr <- data.table(dataExpr)
# load in normalized DESeq2 counts data
rownames(dataExpr)
dataExpr$group <- case_when(
dataExpr$V1 %in% dataExpr$V1[1:5] ~ "Naive",
dataExpr$V1 %in% dataExpr$V1[6:10] ~ "Exposed"
)
### select all genes in red module that are also DEGs for plotting
red_deg_genes <- read.csv("C:/Users/andre/Desktop/GitHub/AK_Pycno_RNAxMetagen/16s_Sylva/qiime2_fullset/WGCNA/red_mod_degs_nf.csv")
redgenes <- read_lines("red_mod_genes_nf.txt")
dataExpr_reddeg <- dataExpr%>% select(c("V1", "group", redgenes))
# maing plots from GO MWU output of Salmon Module from WGNCA
#Top correlated genes in module
setwd("C:/Users/andre/Desktop/GitHub/AK_Pycno_RNAxMetagen/16s_Sylva/qiime2_fullset/WGCNA")
library(tidyverse)
library(data.table)
library(patchwork)
###differentually abundant genes
degs <- read.csv("C:/Users/andre/Desktop/GitHub/AK_Pycno_RNAxMetagen/Pycno_NE_STAR/annotations/NE_DEG_annotated.csv")
###differentially abundant microbes
microbes <- read.csv("C:/Users/andre/Desktop/GitHub/AK_Pycno_RNAxMetagen/16s_Sylva/ancombc_wgcna/8.1.24_res.NvE_Sylva.csv") # 244 microbial families found passing the >10 reads/sample average
dams <- microbes[microbes$diff_abn.site.animal.healthSH==TRUE,] # 39 differential abundance microbes
### Gene ontology mapping to DEGs
pGO <- fread("C:/Users/andre/Desktop/GitHub/AK_Pycno_RNAxMetagen/Pycno_NE_STAR/GO/Pycno_GO_formatted.tsv")
colnames(pGO) <- c("gene_id","GO")
degs_GO <- left_join(degs,pGO, by="gene_id")
dataExpr <- fread("C:/Users/andre/Desktop/GitHub/AK_Pycno_RNAxMetagen/16s_Sylva/qiime2_fullset/WGCNA/dataExpr_normfirst.txt")
dataExpr <- data.table(dataExpr)
# load in normalized DESeq2 counts data
rownames(dataExpr)
dataExpr$group <- case_when(
dataExpr$V1 %in% dataExpr$V1[1:5] ~ "Naive",
dataExpr$V1 %in% dataExpr$V1[6:10] ~ "Exposed"
)
### select all genes in red module that are also DEGs for plotting
red_deg_genes <- read.csv("C:/Users/andre/Desktop/GitHub/AK_Pycno_RNAxMetagen/16s_Sylva/qiime2_fullset/WGCNA/red_mod_degs_nf.csv")
redgenes <- read_lines("red_mod_genes_nf.txt")
dataExpr_reddeg <- dataExpr%>% select(c("V1", "group", redgenes))
# maing plots from GO MWU output of Salmon Module from WGNCA
#Top correlated genes in module
setwd("C:/Users/andre/Desktop/GitHub/AK_Pycno_RNAxMetagen/16s_Sylva/qiime2_fullset/WGCNA")
library(tidyverse)
library(data.table)
library(patchwork)
###differentually abundant genes
degs <- read.csv("C:/Users/andre/Desktop/GitHub/AK_Pycno_RNAxMetagen/Pycno_NE_STAR/annotations/NE_DEG_annotated.csv")
###differentially abundant microbes
microbes <- read.csv("C:/Users/andre/Desktop/GitHub/AK_Pycno_RNAxMetagen/16s_Sylva/ancombc_wgcna/8.1.24_res.NvE_Sylva.csv") # 244 microbial families found passing the >10 reads/sample average
dams <- microbes[microbes$diff_abn.site.animal.healthSH==TRUE,] # 39 differential abundance microbes
### Gene ontology mapping to DEGs
pGO <- fread("C:/Users/andre/Desktop/GitHub/AK_Pycno_RNAxMetagen/Pycno_NE_STAR/GO/Pycno_GO_formatted.tsv")
colnames(pGO) <- c("gene_id","GO")
degs_GO <- left_join(degs,pGO, by="gene_id")
dataExpr <- fread("C:/Users/andre/Desktop/GitHub/AK_Pycno_RNAxMetagen/16s_Sylva/qiime2_fullset/WGCNA/dataExpr_normfirst.txt")
dataExpr <- data.table(dataExpr)
# load in normalized DESeq2 counts data
rownames(dataExpr)
dataExpr$group <- case_when(
dataExpr$V1 %in% dataExpr$V1[1:5] ~ "Naive",
dataExpr$V1 %in% dataExpr$V1[6:10] ~ "Exposed"
)
### select all genes in red module that are also DEGs for plotting
red_deg_genes <- read.csv("C:/Users/andre/Desktop/GitHub/AK_Pycno_RNAxMetagen/16s_Sylva/qiime2_fullset/WGCNA/red_mod_degs_nf.csv")
redgenes <- read_lines("red_mod_genes_nf.txt")
dataExpr_reddeg <- dataExpr%>% dplyr::select(c("V1", "group", redgenes))
rename_vector <- setNames(degs_GO$annote, degs_GO$gene_id)
colnames(dataExpr_reddeg) <- rename_vector[colnames(dataExpr_reddeg)]
colnames(dataExpr_reddeg)<-make.unique(colnames(dataExpr_reddeg))
###### Plotting Module Genes #######
# select(V1, contains("ficolin-2"), contains("echinoidin"),contains("collagen"),contains("lymphocyte"),contains("Complement"),contains("adhesion"),contains("fibrinogen"),matches(".* ADAMTS.*|.*disintegrin.*"), group) %>%
rgenes <- dataExpr_reddeg %>%
select(V1, contains("ficolin-2"), contains("echinoidin"),contains("collagenase"),contains("C-type lectin lectoxin"),contains("collagen alpha"),contains("fibrinogen"), group) %>%
pivot_longer(cols = -c(V1, group),  # Exclude 'V1' and 'group' columns
names_to = "gene",
values_to = "expression") %>%
mutate(gene_type = case_when(
str_detect(gene, "ficolin") ~ "ficolin-2",
str_detect(gene, "echinoidin") ~ "echinoidin",
str_detect(gene,"collagen alpha") ~ "collagen alpha-1(XVII)",
str_detect(gene,"collagenase") ~ "type IV collagenase",
#str_detect(gene,"lymphocyte") ~ "lymphocyte antigen 6",
str_detect(gene,"C-type lectin lectoxin-Phi1-like") ~ "C-type lectin lectoxin-Phi1",
#str_detect(gene,"adhesion") ~ "adhesion G protein-coupled receptor",
str_detect(gene,"fibrinogen") ~ "fibrinogen",
#str_detect(gene,"ADAMTS") ~ "ADAMTS",
#str_detect(gene,"disintegrin") ~ "ADAMTS",
TRUE ~ "other"  # Optional: handle other cases if needed
))
View(dataExpr)
# maing plots from GO MWU output of Salmon Module from WGNCA
#Top correlated genes in module
setwd("C:/Users/andre/Desktop/GitHub/AK_Pycno_RNAxMetagen/16s_Sylva/qiime2_fullset/WGCNA")
library(tidyverse)
library(data.table)
library(patchwork)
###differentually abundant genes
degs <- read.csv("C:/Users/andre/Desktop/GitHub/AK_Pycno_RNAxMetagen/Pycno_NE_STAR/annotations/NE_DEG_annotated.csv")
###differentially abundant microbes
microbes <- read.csv("C:/Users/andre/Desktop/GitHub/AK_Pycno_RNAxMetagen/16s_Sylva/ancombc_wgcna/8.1.24_res.NvE_Sylva.csv") # 244 microbial families found passing the >10 reads/sample average
dams <- microbes[microbes$diff_abn.site.animal.healthSH==TRUE,] # 39 differential abundance microbes
### Gene ontology mapping to DEGs
pGO <- fread("C:/Users/andre/Desktop/GitHub/AK_Pycno_RNAxMetagen/Pycno_NE_STAR/GO/Pycno_GO_formatted.tsv")
colnames(pGO) <- c("gene_id","GO")
degs_GO <- left_join(degs,pGO, by="gene_id")
dataExpr <- fread("C:/Users/andre/Desktop/GitHub/AK_Pycno_RNAxMetagen/16s_Sylva/qiime2_fullset/WGCNA/dataExpr_normfirst.txt")
dataExpr <- data.table(dataExpr)
# load in normalized DESeq2 counts data
rownames(dataExpr)
dataExpr$group <- case_when(
dataExpr$V1 %in% dataExpr$V1[1:5] ~ "Naive",
dataExpr$V1 %in% dataExpr$V1[6:10] ~ "Exposed"
)
### select all genes in red module that are also DEGs for plotting
red_deg_genes <- read.csv("C:/Users/andre/Desktop/GitHub/AK_Pycno_RNAxMetagen/16s_Sylva/qiime2_fullset/WGCNA/red_mod_degs_nf.csv")
redgenes <- read_lines("red_mod_genes_nf.txt")
dataExpr_reddeg <- dataExpr%>% dplyr::select(c("V1", "group", redgenes))
rename_vector <- setNames(degs_GO$annote, degs_GO$gene_id)
colnames(dataExpr_reddeg) <- rename_vector[colnames(dataExpr_reddeg)]
colnames(dataExpr_reddeg)<-make.unique(colnames(dataExpr_reddeg))
###### Plotting Module Genes #######
# select(V1, contains("ficolin-2"), contains("echinoidin"),contains("collagen"),contains("lymphocyte"),contains("Complement"),contains("adhesion"),contains("fibrinogen"),matches(".* ADAMTS.*|.*disintegrin.*"), group) %>%
rgenes <- dataExpr_reddeg %>%
dplyr::select(V1, contains("ficolin-2"), contains("echinoidin"),contains("collagenase"),contains("C-type lectin lectoxin"),contains("collagen alpha"),contains("fibrinogen"), group) %>%
pivot_longer(cols = -c(V1, group),  # Exclude 'V1' and 'group' columns
names_to = "gene",
values_to = "expression") %>%
mutate(gene_type = case_when(
str_detect(gene, "ficolin") ~ "ficolin-2",
str_detect(gene, "echinoidin") ~ "echinoidin",
str_detect(gene,"collagen alpha") ~ "collagen alpha-1(XVII)",
str_detect(gene,"collagenase") ~ "type IV collagenase",
#str_detect(gene,"lymphocyte") ~ "lymphocyte antigen 6",
str_detect(gene,"C-type lectin lectoxin-Phi1-like") ~ "C-type lectin lectoxin-Phi1",
#str_detect(gene,"adhesion") ~ "adhesion G protein-coupled receptor",
str_detect(gene,"fibrinogen") ~ "fibrinogen",
#str_detect(gene,"ADAMTS") ~ "ADAMTS",
#str_detect(gene,"disintegrin") ~ "ADAMTS",
TRUE ~ "other"  # Optional: handle other cases if needed
))
rgenes$group <- factor(rgenes$group, levels = c("Naive", "Exposed"))
rgenes$gene_type <- stringr::str_wrap(rgenes$gene_type, width = 15)
#color_palette <- c("black","red","blue","green","orange","magenta","grey","purple","skyblue2","coral2")
unique(rgenes$gene_type) # catch special invisible characters
rgenes$gene_type <- factor(rgenes$gene_type, levels = c("echinoidin", "ficolin-2", "C-type lectin\nlectoxin-Phi1", "collagen\nalpha-1(XVII)","type IV\ncollagenase","fibrinogen"))
rg <- ggplot(rgenes, aes(x = group, y = expression, fill = group)) +
geom_boxplot(outlier.shape = NA) +
scale_fill_manual(values = c("Exposed" = "lightcoral", "Naive" = "skyblue2")) +
# Points for each sub-transcript mean
stat_summary(aes(group = gene, alpha=0.5),
fun = mean, geom = "point", size = 1.5, position = position_dodge(width = 0.5)) +
stat_summary(aes(group = gene, alpha=0.5),
fun = mean,
geom = "line",
position = position_dodge(width = 0.5)) +
facet_wrap(~ gene_type, scales = "free_x", ncol = 6, strip.position = "bottom") +
labs(title = "Red Module Genes",
x = "Group",
y = "log2 normalized Expression") +
theme_minimal() +
theme(axis.text.x = element_blank(),
strip.placement = "outside",
strip.text.x = element_text(size = 10, angle = 45, hjust = 0.5, face = "bold"),
axis.title.x = element_blank(),
panel.spacing = unit(0.5, "lines"),
panel.border = element_rect(color = "grey", fill = NA, size = 1)) +
guides(color = "none",alpha="none")
########### Plotting Microbes ##############
# pull out genes of interest to plot
red_mico <- dataExpr %>% dplyr::select("V1", "d__Bacteria.p__Proteobacteria.c__Gammaproteobacteria.o__Enterobacterales.f__Vibrionaceae.g__Vibrio.s__","d__Bacteria.p__Bacteroidota.c__Bacteroidia.o__Flavobacteriales.f__Flavobacteriaceae.g__Flavobacterium.s__","d__Bacteria.p__Proteobacteria.c__Gammaproteobacteria.o__Enterobacterales.f__Moritellaceae.g__Moritella.s__","d__Bacteria.p__Firmicutes.c__Clostridia.o__Peptostreptococcales.Tissierellales.f__Peptostreptococcales.Tissierellales.g__JTB215.s__","d__Bacteria.p__Proteobacteria.c__Alphaproteobacteria.o__Rhizobiales.f__Rhizobiaceae.g__Pseudahrensia.s__","d__Bacteria.p__Fusobacteriota.c__Fusobacteriia.o__Fusobacteriales.f__Fusobacteriaceae.g__Psychrilyobacter.s__","group")
# rename and shorten microbe names
colnames(red_mico) = c("V1", "Vibrio.spp","Flavobacterium.spp","Moritella.spp","JTB215.spp","Pseudahrensia.spp","Psychrilyobacter.spp","group")
# elongate df to plot
red_long <- pivot_longer(red_mico, cols = 2:7, names_to = "microbe", values_to = "Value")
red_long$group <- factor(red_long$group, levels = c("Naive", "Exposed"))
# wrap text of long names
red_long$Gene <- stringr::str_wrap(red_long$microbe, width = 15)
red_long$microbe <- factor(red_long$microbe, levels = c("Vibrio.spp","Flavobacterium.spp","Moritella.spp","JTB215.spp","Pseudahrensia.spp","Psychrilyobacter.spp"))
# Create the boxplot
rm <- ggplot(red_long, aes(x = group, y = Value, fill = group)) +
geom_boxplot() +
facet_grid(. ~ microbe, switch = "x") +  # Move gene names to the bottom
scale_fill_manual(values = c("Exposed" = "lightcoral", "Naive" = "skyblue2")) +  # Match exact values from group column
labs(title = "Red Module Microbes",
y = "log2 normalized counts") +  # Remove the x-axis title
theme_minimal() +
theme(axis.text.x = element_blank(),  # remove x axis lables
strip.placement = "outside",  # Place facet labels outside
strip.text.x = element_text(size = 10,angle =50,face = "bold"),  # Adjust facet label size
axis.title.x = element_blank(),  # Remove x-axis title
panel.spacing = unit(0.5, "lines"),
panel.border = element_rect(color = "grey", fill = NA, size = 1)) # Add black borders between facets
red.plot <- (rg/rm)+
plot_layout(guides = "collect",axes = "collect")
############## new plots #####################
library(ggplot2)
library(ggdist)   # for half-violin geom
library(dplyr)
g <- ggplot(rgenes, aes(x = group, y = expression, fill = group, color = group)) +
# # Half violin (distribution)
# ggdist::stat_halfeye(
#   adjust = 0.6,
#   width = 0.8,
#   justification = -0.3,  # shift left/right
#   .width = 0,
#   point_colour = NA,
#   alpha = 0.8
# ) +
# "Rain" points
geom_jitter(
aes(color = group),
width = 0.15,
alpha = 0.8,
size = 1.5
) +
# Optional boxplot overlay for summary
geom_boxplot(
width = 0.75,
outlier.shape = NA,
alpha = 0.70,
color = "grey1",
linewidth = 0.4
) +
scale_fill_manual(values = c("Exposed" = "lightcoral", "Naive" = "skyblue2")) +
scale_color_manual(values = c("Exposed" = "firebrick3", "Naive" = "steelblue4")) +
facet_wrap(~ gene_type, scales = "free_x", ncol = 6, strip.position = "bottom") +
labs(title = "Red Module Genes",
x = "Group",
y = "log2 normalized Expression") +
theme_minimal() +
theme(
#panel.grid = element_blank(),       # removes grid lines
axis.text.x = element_blank(),
strip.placement = "outside",
strip.text.x = element_text(size = 10, angle = 0, hjust = 0.5, face = "bold"),
axis.title.x = element_blank(),
panel.spacing = unit(0.5, "lines"),
panel.border = element_rect(color = "grey", fill = NA, size = 0.5),
plot.title = element_text(size = 13, face = "bold", hjust = 0.5)
) +
guides(fill = guide_legend(position = "bottom"))
g
r <- ggplot(red_long, aes(x = group, y = Value, fill = group, color = group)) +
# Half violin for distribution
# ggdist::stat_halfeye(
#   adjust = 1.0,
#   width = 1.0,
#   justification = -0.3,  # shift left/right
#   .width = 0,
#   point_colour = NA,
#   alpha = 0.8
# ) +
# "Rain" points
geom_jitter(
aes(color = group),
width = 0.15,
alpha = 0.8,
size = 1.5
) +
# Optional boxplot overlay
geom_boxplot(
width = 0.75,
outlier.shape = NA,
alpha = 0.70,
color = "grey1",
linewidth = 0.4
) +
scale_fill_manual(values = c("Exposed" = "lightcoral", "Naive" = "skyblue2")) +
scale_color_manual(values = c("Exposed" = "firebrick3", "Naive" = "steelblue4")) +
facet_grid(. ~ microbe, switch = "x") +  # keep microbes along x-axis
labs(title = "Red Module Microbes",
y = "log2 normalized counts") +
theme_minimal() +
theme(
#panel.grid = element_blank(),       # removes grid lines
axis.text.x = element_blank(),
strip.placement = "outside",
strip.text.x = element_text(size = 10, angle = 0, face = "bold.italic"),
axis.title.x = element_blank(),
panel.spacing = unit(0.5, "lines"),
panel.border = element_rect(color = "grey", fill = NA, size = 0.5),
plot.title = element_text(size = 13, face = "bold", hjust = 0.5)
) +
guides(fill = guide_legend(position = "bottom"))
r
red.plot <- (g / r) +
plot_layout(guides = "collect", axes = "collect") &
theme(legend.position = "bottom")
red.plot
setwd("C:/Users/andre/Desktop/GitHub/P.helianthoides_SSW_Host-Microbial_repo/forGithub_Gene_Microbe_WGCNA")
